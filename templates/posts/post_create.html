{% extends "base.html" %}
{% load widget_tweaks %}
{% block content %}
<div class="container mt-4">
  <h1>Создать новый пост</h1>
  
  <form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    
    {{ form.as_p }}

    <h4>Маршрут согласования:</h4>
    
    <!-- Список пользователей для согласования -->
    <div id="approval-steps">
      <div class="approval-step">
        <label for="approvers">Выберите пользователя для согласования:</label>
        <select name="approvers" class="form-control">
          {% for user in users %}
            <option value="{{ user.id }}">{{ user.get_full_name|default:user.email }}</option>
          {% endfor %}
        </select>
      </div>
    </div>

    <button type="button" class="btn btn-secondary mt-2" onclick="addApprovalStep()">+ Добавить этап</button>

    <br><br>
    <button type="submit" class="btn btn-primary">Создать запись</button>
  </form>

  {% include "posts/includes/link_include.html" %}
</div>

<script>
  function addApprovalStep() {
    const step = document.querySelector('.approval-step').cloneNode(true);
    document.getElementById('approval-steps').appendChild(step);
  }
</script>

{% endblock %}