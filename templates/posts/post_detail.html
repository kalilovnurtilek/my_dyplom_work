{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
  <h1>{{ post.title }}</h1>
  <p><strong>–ê–≤—Ç–æ—Ä:</strong> {{ post.owner.get_full_name }}</p>
  <p>{{ post.content }}</p>

  {% if post.pdf_file %}
    <p><a href="{{ post.pdf_file.url }}" target="_blank">üìé –û—Ç–∫—Ä—ã—Ç—å PDF</a></p>
  {% endif %}

  <p><strong>–°—Ç–∞—Ç—É—Å:</strong> 
    {% if post.status == 'draft' %} –ß–µ—Ä–Ω–æ–≤–∏–∫ 
    {% elif post.status == 'published' %} ‚úÖ –û–ø—É–±–ª–∏–∫–æ–≤–∞–Ω 
    {% endif %}
  </p>
  
  <p><strong>–°—Ç–∞—Ç—É—Å —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è:</strong> 
    {% if post.status_approval == 'not_started' %}
      –û–∂–∏–¥–∞–µ—Ç –Ω–∞—á–∞–ª–∞
    {% elif post.status_approval == 'in_progress' %}
      –í –ø—Ä–æ—Ü–µ—Å—Å–µ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è
    {% elif post.status_approval == 'approved' %}
      ‚úÖ –û–¥–æ–±—Ä–µ–Ω–æ
    {% elif post.status_approval == 'rejected' %}
      ‚ùå –û—Ç–∫–ª–æ–Ω–µ–Ω–æ
    {% endif %}
  </p>

  {% if post.current_approver %}
    <p><strong>–¢–µ–∫—É—â–∏–π —Å–æ–≥–ª–∞—Å—É—é—â–∏–π:</strong> {{ post.current_approver.get_full_name }}</p>
  {% else %}
    <p><strong>–°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ</strong></p>
  {% endif %}

  <hr>

  <h4>–ú–∞—Ä—à—Ä—É—Ç —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è:</h4>
  <ul>
    {% for step in approval_steps %}
      <li>
        {{ step.order }}. {{ step.user.get_full_name|default:step.user.email }} ‚Äî 
        {% if step.is_approved == True %}
          ‚úÖ –°–æ–≥–ª–∞—Å–æ–≤–∞–Ω–æ ({{ step.reviewed_at|date:"d.m.Y H:i" }})
        {% elif step.is_approved == False %}
          ‚ùå –û—Ç–∫–ª–æ–Ω–µ–Ω–æ ({{ step.reviewed_at|date:"d.m.Y H:i" }})
        {% else %}
          ‚è≥ –û–∂–∏–¥–∞–µ—Ç
        {% endif %}
      </li>
    {% endfor %}
  </ul>

  {% if can_approve %}
    <hr>
    <h4>–í—ã –¥–æ–ª–∂–Ω—ã —Å–æ–≥–ª–∞—Å–æ–≤–∞—Ç—å —ç—Ç–æ—Ç –ø–æ—Å—Ç:</h4>
    <form method="post">
      {% csrf_token %}
      <input type="hidden" name="action" value="approval">
      <button type="submit" name="approve" class="btn btn-success">–°–æ–≥–ª–∞—Å–æ–≤–∞—Ç—å</button>
      <button type="submit" name="reject" class="btn btn-danger">–û—Ç–∫–ª–æ–Ω–∏—Ç—å</button>
    </form>
  {% endif %}

  <hr>
  <h4>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏:</h4>
  <ul>
    {% for comment in comments %}
      <li><strong>{{ comment.author }}</strong>: {{ comment.text }} <br>
          <small>{{ comment.created|date:"d.m.Y H:i" }}</small>
      </li>
    {% empty %}
      <li>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –ø–æ–∫–∞ –Ω–µ—Ç.</li>
    {% endfor %}
  </ul>

  {% if user.is_authenticated %}
    <hr>
    <h4>–î–æ–±–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π:</h4>
    <form method="post">
      {% csrf_token %}
      <input type="hidden" name="action" value="comment">
      {{ form.as_p }}
      <button type="submit" class="btn btn-primary">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
    </form>
  {% else %}
    <p>–í—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã, —á—Ç–æ–±—ã –æ—Å—Ç–∞–≤–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π.</p>
  {% endif %}
</div>
{% endblock %}
